<!DOCTYPE html>
<html>
    <head>
    <title>URL COVID QR</title>
    
    <link rel="stylesheet" type="text/css" href="index.css" />
    <script src="jquery-3.5.1.min.js"> </script>
    <script src="html5-qrcode.min.js"></script>
    <script src="library.js"> </script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>    

<script type="text/javascript">
var estaciones = [];

async function fetchData() {
  var res;
  res = await fetch("https://arcgis-web.url.edu.gt/incyt/api/qr/getUbicaciones");
  this.estaciones = await res.json();
  console.log(this.estaciones);
  cargaEstacion('selectEstacion2')
}


function cargaEstacion(s) {
  var select = document.getElementById(s);

  var el = document.createElement("option");
  el.textContent = " "; // this.estaciones[i].estacion;
  el.value = " "; //this.estaciones[i].estacion;
  select.appendChild(el);

  for (var i = 0; i < this.estaciones.length; i++) {
    var el = document.createElement("option");
    el.textContent = this.estaciones[i].nombre;
    el.value = this.estaciones[i].ubicacion;
    select.appendChild(el);
  }
  //this.parms.estacion = this.estaciones[0].estacion;
}


async function getDatea(){

  var u = document.getElementById("selectEstacion2").value;
  var fecha = document.getElementById("f1").value;
  var hora1 = document.getElementById("t1").value;
  var hora2 = document.getElementById("t2").value;
  var url = `https://arcgis-web.url.edu.gt/incyt/api/qr/getRangoAsistencia?ubicacion=${u}&fecha=${fecha}&horaInicial=${hora1}&horaFinal=${hora2}`;

  //console.log(url);
  var res;
  res = await fetch(url);
  var d = await res.json();
  //console.log(d);
  var resultContainer = document.getElementById('resultados');
  resultContainer.innerHTML = "";
  for(var i = 0; i < d.length; d++){
    resultContainer.innerHTML  += `<div>${d[i].carnet}  ${d[i].fecha}</div>`;
  }

}

</script>
     
    </head>
    
      <body onload="fetchData()">
        <nav class="navbar navbar-inverse " style="font-size: xx-large;">
            <div class="container-fluid">
              <div class="navbar-header">
                <a class="navbar-brand" href="#">QR URL</a>
              </div>
              <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">Inicio</a></li>
                <li><a href="reportar.html">Reportarse Positivo</a></li>
                <li><a href="asistencia.html">Asistencia</a></li>
              </ul>
            </div>
          </nav>


    <div id="main fs20" >
      <h1>Reporte de asistencia</h1>


      <div class="input-group mb-3 center">
        <div class="input-group-append">
          <label class="input-group-text" for="selectEstacion2"
            >Ubicacion</label
          >
        </div>
        <select class="custom-select" id="selectEstacion2">
          <!-- <option selected>Choose...</option> -->
        </select>
      </div>

      <div>
        <label>Seleccione fecha a generar</label><br>
        <input type="date" id="f1" name="f1">
      </div>
      
      <div>
        <label>Seleccione hora Inicial</label><br>
        <input type="time" id="t1" name="t1">
      </div>

      <div>
        <label>Seleccione hora Final</label><br>
        <input type="time" id="t2" name="t2">
      </div>
      
     </div> 


    <button class="btn btn-primary  navbar-btn" onclick="getDatea()" >Generar reporte</button>
     <br><br>
    <div id = "resultados"> </div>


  </body>

  </html>


<script>
  console.log('Herlich Gonzalez 2021');
</script>